# 📐 DESIGN.md: tumsat 履修補助 2025 設計ドキュメント

## 1\. 🎯 プロジェクト概要

| 項目             | 詳細                                                                                                                         |
| :--------------- | :--------------------------------------------------------------------------------------------------------------------------- |
| **アプリ名**     | **tumsat 履修補助 2025**                                                                                                     |
| **目的**         | 大学の履修システム（特に進級・卒業要件）の複雑さを解消し、学生が自身の履修状況と残り単位数を正確に把握できるように補助する。 |
| **対象ユーザー** | 大学の在学生 2024 年度入学者以降を想定）                                                                                     |
| **開発技術**     | **SwiftUI** (モバイルアプリ)                                                                                                 |
| **データ管理**   | **ローカルストレージ**に依存。アカウント、認証、サーバー連携機能は**不要**。                                                 |
| **メンテナンス** | 毎年、年度が変わる頃（主にカリキュラム変更時）にアップデートを計画。                                                         |

---

## 2\. 📱 アプリのフローと画面構成

### 2.1. 初回起動/データ登録フロー

1.  **🎓 学科・学年登録:**
    - ユーザーに「**学科**」「**現在の学年**」を選択・登録させる。
2.  **📝 過去の単位登録:**
    - 登録された学年に基づき、1 年生前期から現学年の直前の学期までの履修済み科目を学期ごとにダイアログで選択させる。
    - 入力情報：**科目名（学期ごと選択）**
3.  **🏠 メインページへ遷移。**

### 2.2. 学期判定ロジック

現在の日付に基づき、単位計算や進級条件のチェックを行う際の学期を判定する。

- **前期:** **3 月 1 日 〜 8 月 31 日**
- **後期:** **9 月 1 日 〜 2 月 28/29 日**

### 2.3. メインページ（2 タブ構成）

メインページは、2 つのタブで構成され、いずれのタブも画面上部に「必修」、下部に「選択」の単位情報を表示するレイアウトを共通とする。

| タブ名                     | 目的                                           | 上部（必修）表示内容                                    | 下部（選択）表示内容               |
| :------------------------- | :--------------------------------------------- | :------------------------------------------------------ | :--------------------------------- |
| **左: 残り習得すべき単位** | 進級・卒業要件の達成状況確認と履修計画の補助。 | 項目ごとの「**あと X 単位**」と**進級基準不足単位数**。 | 項目ごとの「**あと X 単位**」。    |
| **右: 習得済み単位**       | 過去の履修実績（成績）確認。                   | 項目ごとの「**習得済み単位数**」。                      | 項目ごとの「**習得済み単位数**」。 |

---

## 3\. 🖥️ メインページ詳細機能

### 3.1. 左タブ: 残り習得すべき単位 (Remaining Credits)

- **画面右上機能:** **進級条件切り替えトグル/タブ**を配置。
  - 切り替え項目: **2 年進級**、**3 年進級**、**4 年進級**、**卒業条件**。
- **表示ロジックの核:** 選択された進級/卒業条件とユーザーの履修済み単位に基づき、「進級基準に算入される単位数」が基準に達しているかを計算し、不足単位数を項目ごとに表示する。

#### 総合科目内訳表示機能（重要）

- **必修欄の「総合科目」タップ時:**
  - **各分類ごとの不足単位数**を表示するダイアログを出す。
  - 表示内容例: `文化学系: あと X 単位`, `外国語系(必修): あと Y 単位`など。

#### 3 年次進級時の特定科目チェック（警告）

- [cite\_start]**3 年次進級条件選択時:** 以下の指定科目のうち、未修得のものがあれば、単位数とは別に**警告メッセージ**を表示する [cite: 1251, 1252]。
  - 指定科目: `Basic English I`、`Basic English II`、`Practical English I`、`微分積分Ⅰ`、`線形代数Ⅰ`、`物理学`。

### 3.2. 右タブ: 習得済み単位 (Acquired Credits)

- **必修・選択の各項目タップ時:**
  - **内訳ダイアログ表示:** その項目で修得した**授業名**の一覧を表示する。
  - 各授業名の横に、登録された\*\*習得難易度（H, M, E）\*\*を表示する。

---

## 4\. 💾 データ構造 (ローカルストレージ)

### 4.1. ユーザーデータモデル（User/Student Profile）

| フィールド名     | 型       | 説明                |
| :--------------- | :------- | :------------------ |
| `enrollmentYear` | `int`    | 入学年度 (例: 2024) |
| `currentGrade`   | `int`    | 現在の学年 (例: 3)  |
| `department`     | `String` | 所属学科名          |

### 4.2. 履修済み単位モデル（Acquired Credit）

| フィールド名   | 型       | 説明                                                                                                               |
| :------------- | :------- | :----------------------------------------------------------------------------------------------------------------- |
| `courseName`   | `String` | 授業科目名                                                                                                         |
| `credits`      | `int`    | 単位数                                                                                                             |
| `difficulty`   | `String` | 習得難易度 (`H`, `M`, `E`)                                                                                         |
| `category`     | `String` | 科目分類（例: `総合科目-文化学系`, `基礎教育-必修`など）                                                           |
| `isOverCredit` | `bool`   | [cite\_start]進級/卒業要件単位数を超過した単位か (`True`の場合は進級基準に**算入しない**) [cite: 1231, 1258, 1286] |

### 4.3. 静的履修条件データ（Static Curriclum Rules）

アプリ内部にハードコード、または JSON ファイルとして保持する想定。

| フィールド名              | 型                 | 説明                                                                                               |
| :------------------------ | :----------------- | :------------------------------------------------------------------------------------------------- |
| `year`                    | `int`              | 適用される入学年度 (例: 2023)                                                                      |
| `department`              | `String`           | 適用される学科名                                                                                   |
| `reqType`                 | `String`           | 進級・卒業要件タイプ (`Grade2`, `Grade3`, `Grade4`, `Graduation`)                                  |
| `totalRequiredCredits`    | `int`              | [cite\_start]進級基準に算入される**総単位数の基準値**（例: 3 年次進級 65 単位） [cite: 1257, 1285] |
| `categoryRequiredCredits` | `Map<String, int>` | [cite\_start]各科目区分の**卒業要件単位数**（オーバー単位判定に使用） [cite: 1241]                 |
| `compositeSubjectDetails` | `Map<String, int>` | [cite\_start]**総合科目**の**内訳条件** (例: `文化学系: 4`、`外国語系(必修): 4`など) [cite: 1322]  |
| `requiredCourses3rd`      | `List<String>`     | [cite\_start]3 年次進級に必須の**指定科目名リスト** [cite: 1251, 1252]                             |

---

## 5\. 🧮 進級判定コアロジック

### 5.1. 計算の基本原則

1.  [cite\_start]**オーバー単位の除外:** 「進級基準に算入される単位数」を計算する際、各科目区分ごとの**卒業要件単位数**を超えて修得した単位（オーバー単位）は、総修得単位数から差し引く [cite: 1231, 1233]。
2.  [cite\_start]**算入対象の特定 (海事システム工学科の例):** 3 年次・4 年次進級の際、専門科目【選択科目】は卒業要件内の特定の区分（基盤数理系、船舶管理系/海事工学系）に限り上限単位数（例：4 単位、22 単位）が設定され、これを超過した単位は進級基準に算入しない [cite: 1260, 1261, 1262, 1288, 1289, 1290]。

### 5.2. `calculateSaninCredits()`関数の擬似コード(これは Flutter 版なので参考までに)

```dart
// ユーザーの入学年度と履修済み単位を元に、進級基準に算入される単位数を計算する
int calculateSaninCredits(
    List<AcquiredCredit> acquiredCredits,
    Map<String, int> requiredLimits, // 'categoryRequiredCredits' (卒業要件単位数)
    String department,
    int enrollmentYear
) {
    int totalSaninCredits = 0;
    Map<String, int> acquiredCreditsByCategory = {}; // 区分ごとの累計単位

    // 1. 各区分で修得した単位を累計する
    for (var credit in acquiredCredits) {
        acquiredCreditsByCategory[credit.category] = (acquiredCreditsByCategory[credit.category] ?? 0) + credit.credits;
    }

    // 2. 区分ごとにオーバー単位をチェックし、算入単位数を計算する
    for (var category in acquiredCreditsByCategory.keys) {
        int acquired = acquiredCreditsByCategory[category]!;
        int limit = requiredLimits[category] ?? 999; // 卒業要件の制限

        // '進級基準に算入される単位' = min(修得単位, 卒業要件単位数)
        int saninCredits = min(acquired, limit);

        totalSaninCredits += saninCredits;
    }

    return totalSaninCredits;
}
```
